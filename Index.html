<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pirâmide de Bird - Calculadora</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; color: #333; }
        h1 { text-align: center; color: #2c3e50; }
        .piramide { display: flex; flex-direction: column; align-items: center; gap: 10px; margin: 30px 0; }
        .nivel { text-align: center; padding: 15px; border-radius: 8px; width: 60%; box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: transform 0.2s; }
        .nivel:hover { transform: scale(1.02); }
        
        /* Cores baseadas na severidade */
        .n1 { background: #e74c3c; color: white; width: 20%; } /* Grave */
        .n2 { background: #e67e22; color: white; width: 40%; } /* Menor */
        .n3 { background: #f1c40f; color: #333; width: 60%; } /* Dano */
        .n4 { background: #2ecc71; color: white; width: 80%; } /* Near Miss */

        .controles { display: flex; flex-direction: column; align-items: center; }
        input[type="number"] { width: 60px; padding: 5px; border-radius: 4px; border: none; text-align: center; font-weight: bold; }
        input[type="range"] { width: 80%; margin-top: 5px; cursor: pointer; }
        
        #resultados { margin-top: 30px; border-top: 2px solid #eee; padding-top: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
        th { background-color: #f8f9fa; }
        .mismatch-high { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Pirâmide de Bird: Calculadora</h1>
    <p style="text-align: center;">Ajuste os valores. O modelo usa o "Near Miss" (N4) como base para projetar o esperado nos níveis acima.</p>
    
    <div class="piramide">
        <div class="nivel n1">
            <label><strong>Grave (N1)</strong></label>
            <div class="controles">
                <input type="number" id="N1" min="0" value="1" oninput="syncSlider('N1')">
                <input type="range" id="sliderN1" min="0" max="100" value="1" oninput="syncInput('N1')">
            </div>
        </div>

        <div class="nivel n2">
            <label><strong>Menor (N2)</strong></label>
            <div class="controles">
                <input type="number" id="N2" min="0" value="10" oninput="syncSlider('N2')">
                <input type="range" id="sliderN2" min="0" max="100" value="10" oninput="syncInput('N2')">
            </div>
        </div>

        <div class="nivel n3">
            <label><strong>Dano Material (N3)</strong></label>
            <div class="controles">
                <input type="number" id="N3" min="0" value="30" oninput="syncSlider('N3')">
                <input type="range" id="sliderN3" min="0" max="200" value="30" oninput="syncInput('N3')">
            </div>
        </div>

        <div class="nivel n4">
            <label><strong>Near Miss (N4)</strong></label>
            <div class="controles">
                <input type="number" id="N4" min="0" value="600" oninput="syncSlider('N4')">
                <input type="range" id="sliderN4" min="0" max="1000" value="600" oninput="syncInput('N4')">
            </div>
        </div>
    </div>
    
    <div id="resultados"></div>

    <script>
        // Sincroniza Slider -> Input e Recalcula
        function syncInput(id) {
            document.getElementById(id).value = document.getElementById('slider' + id).value;
            calcular();
        }

        // Sincroniza Input -> Slider e Recalcula
        function syncSlider(id) {
            document.getElementById('slider' + id).value = document.getElementById(id).value;
            calcular();
        }
        
        function calcular() {
            const N4 = parseFloat(document.getElementById('N4').value) || 0;
            const N3 = parseFloat(document.getElementById('N3').value) || 0;
            const N2 = parseFloat(document.getElementById('N2').value) || 0;
            const N1 = parseFloat(document.getElementById('N1').value) || 0;
            
            // Ratios baseados em 1:10:30:600
            // Usando N4 como a "verdade" do chão de fábrica
            const ratio14 = 600; 
            const ratio24 = 60;  // 600/10
            const ratio34 = 20;  // 600/30
            
            const lambda1 = N4 / ratio14;
            const lambda2 = N4 / ratio24;
            const lambda3 = N4 / ratio34;
            
            // Probabilidade Poisson P(>=1) = 1 - e^(-lambda)
            const p1 = 1 - Math.exp(-lambda1);
            const p2 = 1 - Math.exp(-lambda2);
            const p3 = 1 - Math.exp(-lambda3);
            
            // Cálculo do desvio (Mismatch)
            // Evita divisão por zero
            const mismatch1 = lambda1 > 0 ? Math.abs((N1 - lambda1) / lambda1 * 100) : 0;
            const mismatch2 = lambda2 > 0 ? Math.abs((N2 - lambda2) / lambda2 * 100) : 0;
            const mismatch3 = lambda3 > 0 ? Math.abs((N3 - lambda3) / lambda3 * 100) : 0;
            
            // Formatação condicional para desvios altos (>50%)
            const classM1 = mismatch1 > 50 ? 'mismatch-high' : '';
            const classM2 = mismatch2 > 50 ? 'mismatch-high' : '';
            const classM3 = mismatch3 > 50 ? 'mismatch-high' : '';

            let tabela = `
                <h2>Análise Probabilística</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Nível</th>
                            <th>Observado (Real)</th>
                            <th>Esperado (Teórico)</th>
                            <th>Prob. de Ocorrência*</th>
                            <th>Desvio (Mismatch)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Grave (N1)</td>
                            <td>${N1}</td>
                            <td>${lambda1.toFixed(2)}</td>
                            <td>${(p1*100).toFixed(1)}%</td>
                            <td class="${classM1}">${mismatch1.toFixed(1)}%</td>
                        </tr>
                        <tr>
                            <td>Menor (N2)</td>
                            <td>${N2}</td>
                            <td>${lambda2.toFixed(2)}</td>
                            <td>${(p2*100).toFixed(1)}%</td>
                            <td class="${classM2}">${mismatch2.toFixed(1)}%</td>
                        </tr>
                        <tr>
                            <td>Dano Material (N3)</td>
                            <td>${N3}</td>
                            <td>${lambda3.toFixed(2)}</td>
                            <td>${(p3*100).toFixed(1)}%</td>
                            <td class="${classM3}">${mismatch3.toFixed(1)}%</td>
                        </tr>
                        <tr>
                            <td>Near Miss (N4)</td>
                            <td>${N4}</td>
                            <td>-</td>
                            <td>BASE</td>
                            <td>-</td>
                        </tr>
                    </tbody>
                </table>
                <p><small>* Probabilidade de haver pelo menos 1 evento dado o volume de N4, assumindo distribuição de Poisson.</small></p>
            `;
            document.getElementById('resultados').innerHTML = tabela;
        }
        
        // Inicializa
        calcular();
    </script>
</body>
</html>
